# -*- coding: utf-8 -*-
# Generated by Django 1.11.13 on 2018-08-09 16:09
from __future__ import unicode_literals

from django.db import migrations
from directory_constants.constants import cms


def remove_invest_from_slugs(apps, schema_manager):
    Service = apps.get_model('core', 'Service')
    Page = apps.get_model('wagtailcore', 'Page')
    pages = Page.objects.filter(
        service__in=Service.objects.filter(name=cms.INVEST)
    )
    for page in pages:
        if page.slug.startswith('invest-'):
            page.slug = page.slug[7:]
            page.save()


def append_invest_to_slugs(apps, schema_manager):
    Service = apps.get_model('core', 'Service')
    Page = apps.get_model('wagtailcore', 'Page')
    pages = Page.objects.filter(
        service__in=Service.objects.filter(name=cms.INVEST)
    )
    for page in pages:
        page.slug = 'invest-{slug}'.format(slug=page.slug)
        page.save()


class Migration(migrations.Migration):

    dependencies = [
        ('invest', '0007_auto_20180719_1414'),
        ('core', '0008_auto_20180809_1215')
    ]

    operations = [
        migrations.RunPython(
            remove_invest_from_slugs,
            reverse_code=append_invest_to_slugs
        )
    ]
